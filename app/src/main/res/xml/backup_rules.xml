<?xml version="1.0" encoding="utf-8"?>
<!--
  ═══════════════════════════════════════════════════════════════════════════════
  BACKUP RULES - КРИТИЧНО ДЛЯ БЕЗОПАСНОСТИ
  ═══════════════════════════════════════════════════════════════════════════════
  
  ПРОБЛЕМА:
  - SecureSettingsDataStore шифрует API ключи с использованием AndroidKeyStore
  - Ключ из AndroidKeyStore привязан к конкретному устройству (hardware-bound)
  - При восстановлении бэкапа на другом устройстве ключа НЕТ
  - Зашифрованные данные становятся НЕЧИТАЕМЫМИ навсегда
  
  РЕШЕНИЕ:
  - Исключаем из бэкапа все зашифрованные данные
  - Разрешаем бэкапить только UI настройки (тема, язык и т.д.)
  
  РИСК БЕЗ ЭТОГО:
  - Пользователь делает factory reset или покупает новый телефон
  - Android восстанавливает приложение из Google Drive
  - API ключи потеряны навсегда → приложение неработоспособно
  ═══════════════════════════════════════════════════════════════════════════════
-->
<full-backup-content>
    
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <!-- ИСКЛЮЧЕНИЯ (НЕ бэкапить) -->
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- 1. Зашифрованные настройки (API ключи, GitHub токены) -->
    <exclude domain="sharedpref" path="secure_settings_encrypted.preferences_pb" />
    
    <!-- 2. База данных с кешированным кодом (может содержать секреты) -->
    <exclude domain="database" path="opuside_database" />
    <exclude domain="database" path="opuside_database-shm" />
    <exclude domain="database" path="opuside_database-wal" />
    
    <!-- 3. DataStore с состоянием таймера кеша (привязан к encrypted DB) -->
    <exclude domain="sharedpref" path="cache_timer.preferences_pb" />
    
    <!-- 4. Временные файлы и логи -->
    <exclude domain="file" path="cache/" />
    <exclude domain="file" path="code_cache/" />
    
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <!-- ВКЛЮЧЕНИЯ (МОЖНО бэкапить) -->
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- Только UI настройки (тема, размер шрифта, язык и т.д.) -->
    <!-- Эти данные НЕ содержат секретов и безопасны для бэкапа -->
    <include domain="sharedpref" path="opuside_settings.preferences_pb" />
    
</full-backup-content>
